$.widget("custom.PTContextMenu",{options:{activation:"hover",items:null,zIndex:5,FadeTime:50,callBack:null,SubMenuCloseCallBack:null,close:null,classexception:[]},_create:function(){var self=this;self.PreventFromCallingGlobalCallBack=false;self.PreventFromCreating=false;this.element.addClass(self.options.activation==="leftclick"?"wt-ContextMenu wt-ContextLeftClick":"wt-ContextMenu").disableSelection();this.CreateElement=function(){self.RemoveAllElementInPlugin();var list=$('<ul class="PTMainContextMenu" style=" display:none; position:absolute;  z-index:'+self.options.zIndex+'">');$.each(self.options.items(),function(i,value){var IsItemDisabled=false;if(typeof value.disabled!=='undefined'){if(value.disabled===true){IsItemDisabled=true;}}
var item=$('<li '+((IsItemDisabled)?' IsDisabled="true"':"")+((value.className)?' class="'+value.className+'"':"")+' ItemCallBackName="'+i+'">'+((!value.appendElement)?value.name:"")+'</li>')
if(value.appendElement){item.append(value.appendElement);}
if(value.callback){SubscribeClickEventOnItem(item,value.callback);}
if(value.items){item.addClass('PTContext-Sub-Menu');checkChild(value.items,item);}
if(value.HasBorderTop){list.append('<hr>');}
list.append(item);});self.ContextMenu=list;self.element.append(self.ContextMenu);function checkChild(items,parent){var children=$('<ul>');$.each(items,function(i,value){var IsItemDisabled=false;if(typeof value.disabled!=='undefined'){if(value.disabled===true){IsItemDisabled=true;}}
var item=$('<li '+((IsItemDisabled)?' IsDisabled="true"':"")+((value.className)?' class="'+value.className+'"':"")+' ItemCallBackName="'+i+'">'+((!value.appendElement)?value.name:"")+'</li>')
if(value.appendElement){item.append(value.appendElement);}
if(value.callback){SubscribeClickEventOnItem(item,value.callback);}
children.append(item);if(value.items){item.addClass('PTContext-Sub-Menu');checkChild(value.items,item);}
if(value.HasBorderTop){parent.append('<hr>');}
parent.append(children);});}
function SubscribeClickEventOnItem(item,callback){item.on('click',function(e){if(!$(e.target).attr('IsDisabled')){var CallBackReturn=callback($(e.target).attr('ItemCallBackName'));if(typeof CallBackReturn!=='undefined'){if(CallBackReturn){self.RemoveAllElementInPlugin(true);if(self.options.activation==="leftclick"){self.PreventFromCreating=true;}}}
else{self.RemoveAllElementInPlugin(true);}
self.PreventFromCallingGlobalCallBack=true;}});}
self.element.find('.PTContext-Sub-Menu').hover(function(){$($(this).find('ul')[0]).removeAttr('style');$($(this).find('ul')[0]).css('left','100%');$($(this).find('ul')[0]).css('top','-2px');var IsWidthOverlap=false;if($($(this).find('ul')[0]).offset()){if($($(this).find('ul')[0]).offset().left+$($(this).find('ul')[0]).outerWidth()>$(document).width()){$($(this).find('ul')[0]).removeAttr('style');$($(this).find('ul')[0]).css('right','100%');IsWidthOverlap=true;}}
$($(this).find('ul')[0]).css('top','-2px');if($($(this).find('ul')[0]).offset()){if($($(this).find('ul')[0]).offset().top+$($(this).find('ul')[0]).outerHeight()>$(document).height()){$($(this).find('ul')[0]).removeAttr('style');if(IsWidthOverlap){$($(this).find('ul')[0]).css('right','100%');}
else{$($(this).find('ul')[0]).css('left','100%');}
$($(this).find('ul')[0]).css('bottom','0%');}}
$($(this).find('ul')[0]).css('visibility','visible');},function(e){if(!$(e.relatedTarget).hasClass("wt-shadow")){$($(this).find('ul')[0]).css('visibility','hidden');if(self.options.SubMenuCloseCallBack!==null){self.options.SubMenuCloseCallBack();}}});};this.element.on("contextmenu",function(e){if(self.options.activation==="rightclick"){self.CreateElement();self.ContextMenu.fadeIn(self.options.FadeTime);if(self.HoveredXAxis+self.ContextMenu.width()>self.element.width()+10){self.HoveredXAxis=self.HoveredXAxis-self.ContextMenu.width();}
if(self.HoveredXAxis<0){self.HoveredXAxis=0;}
self.ContextMenu.css({"left":self.HoveredXAxis,"top":self.HoveredYAxis});}
return false;});if(self.options.activation==="rightclick"){self.element.mousemove(function(e){var elem=self.element.offset();self.HoveredXAxis=e.pageX-elem.left;self.HoveredYAxis=e.pageY-elem.top;});}
this.element.on('click',function(e){if(self.options.activation==="leftclick"){if(self.ContextMenu===null||self.ContextMenu===undefined){if(!self.PreventFromCreating){self.CreateElement();self.ContextMenu.fadeIn(0);if($(this).find('.PTMainContextMenu').offset().left+$(this).find('.PTMainContextMenu').outerWidth()>$(document).width()){self.ContextMenu.css({"left":$(this).find('.PTMainContextMenu').position().left-$(this).find('.PTMainContextMenu').outerWidth()});}}
else{self.PreventFromCreating=false;}}}
if(self.ContextMenu){if(!self.ContextMenu.is(e.target)&&self.ContextMenu.has(e.target).length===0){if(self.options.activation==="rightclick"){self.RemoveAllElementInPlugin(true);}}
else{if($(e.target).hasClass('PTContext-Sub-Menu')){return;};if(self.options.callBack){if(!$(e.target).attr('IsDisabled')&&!$(e.target).closest('li').attr('IsDisabled')){var ItemCallBackName=$(e.target).attr('ItemCallBackName');if(typeof ItemCallBackName==="undefined"){ItemCallBackName=$(e.target).closest('li').attr('ItemCallBackName');}
if(typeof ItemCallBackName==="undefined"){return;}
if(self.options.callBack){if(self.PreventFromCallingGlobalCallBack){self.PreventFromCallingGlobalCallBack=false;}
else{var CallBackReturn=self.options.callBack(ItemCallBackName);if(typeof CallBackReturn!=='undefined'){if(CallBackReturn){self.RemoveAllElementInPlugin(true);}}
else{self.RemoveAllElementInPlugin(true);}}}}};}}});this.RemoveAllElementInPlugin=function(isClosed){if(isClosed&&isClosed===true){if(self.element.find('.PTMainContextMenu').length!==0){if(self.options.close!==null){self.options.close();}}}
self.element.find('.PTMainContextMenu').remove();self.ContextMenu=null;};this.element.hover(function(){if(self.options.activation==="hover"){self.CreateElement();self.ContextMenu.fadeIn(0);if(self.HoveredXAxis+self.ContextMenu.width()>self.element.width()+10){self.HoveredXAxis=self.HoveredXAxis-self.ContextMenu.width();}
if($(this).find('.PTMainContextMenu').offset().left+$(this).find('.PTMainContextMenu').outerWidth()>$(document).width()){self.ContextMenu.css({"left":$(this).find('.PTMainContextMenu').position().left-$(this).find('.PTMainContextMenu').outerWidth()});}}},function(e){if(!$(e.relatedTarget).hasClass("sp-container")&&!$(e.relatedTarget).hasClass("sp-palette-container")&&!$(e.relatedTarget).hasClass("wt-ssp-container")&&!$(e.relatedTarget).hasClass("wt-ssp-header")&&!$(e.relatedTarget).hasClass("wt-ssp-header-textbox")&&!$(e.relatedTarget).hasClass("wt-shadow")){self.RemoveAllElementInPlugin(true);}});$(document).click(function myfunction(e){if($.inArray(e.target.className,self.options.classexception)==-1&&!self.element.is(e.target)&&self.element.has(e.target).length===0){self.RemoveAllElementInPlugin(true);}});},_destroy:function(){self.RemoveAllElementInPlugin();self.element.removeClass('wt-ContextMenu');},_setOptions:function(){this._superApply(arguments);}});